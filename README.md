# Бесконечный кроссворд

Автоматически генерируемый бесконечный кроссворд с интерактивной навигацией.

## Идея проекта

Интерактивный кроссворд на бесконечном холсте, который автоматически генерируется алгоритмом. Пользователь может перемещаться по кроссворду с помощью мыши или клавиатуры, исследуя сгенерированные слова.

### Особенности

- **Бесконечная генерация** — алгоритм расширяет кроссворд, добавляя слова перпендикулярно существующим
- **Авто-расширение** — новые слова генерируются при перемещении камеры
- **Жадный алгоритм** — выбирает слова с максимальным количеством пересечений
- **O(1) поиск слов** — индекс по буквам для быстрой фильтрации
- **Ленивый рендеринг** — отрисовываются только видимые клетки
- **Плавная навигация** — управление камерой с интерполяцией

## Структура проекта

```
crossword/
├── frontend/
│   ├── index.html      # HTML страница с canvas
│   ├── interface.js    # Рендеринг и управление камерой (Paper.js)
│   ├── generation.js   # Класс Crossword для отображения
│   └── main.js         # Инициализация, загрузка и авто-расширение
├── backend/
│   ├── package.json    # Зависимости Node.js
│   ├── server.js       # Express сервер с сессиями
│   ├── generation.js   # Алгоритм генерации кроссворда
│   ├── wordIndex.js    # O(1) индекс слов по буквам
│   ├── wordsBank.js    # Банк русских слов
│   └── deploy.sh       # Скрипт деплоя на сервер
├── tests/
│   ├── test_crossword.py  # Selenium тесты
│   ├── requirements.txt   # Python зависимости
│   └── run_tests.sh       # Запуск тестов
├── .github/workflows/
│   ├── deploy.yml         # Деплой frontend на GitHub Pages
│   ├── deploy-backend.yml # Деплой backend на mc.skrup.ru
│   └── auto-merge.yml     # Авто-мерж feature веток в dev
└── README.md
```

## Запуск

### Backend (локально)

```bash
cd backend
npm install
npm start
```

Сервер запустится на `http://localhost:3000`

### Frontend

Открыть `frontend/index.html` в браузере или использовать live server.

**Важно:** Бэкенд должен быть запущен перед открытием фронтенда.

## Продакшен

- **Backend:** `http://mc.skrup.ru:3000`
- **Frontend:** GitHub Pages (ветка `dev`)

### Деплой бэкенда

Ручной деплой:
```bash
cd backend
./deploy.sh
```

Автоматический деплой: push в ветку `dev` с изменениями в `backend/` запускает GitHub Action.

Бэкенд работает через pm2:
```bash
ssh sergey@mc.skrup.ru "pm2 status crossword-api"
ssh sergey@mc.skrup.ru "pm2 logs crossword-api"
```

## API

### GET /api/generate

Генерирует кроссворд.

**Параметры:**
- `count` (number) — количество слов для генерации (default: 30)
- `seed` (string) — начальное слово (default: "кроссворд")

**Пример:**
```
GET /api/generate?count=50&seed=программа
```

**Ответ:**
```json
{
  "sessionId": "uuid",
  "words": [
    { "word": "кроссворд", "x": 0, "y": 0, "direction": "horizontal" },
    { "word": "время", "x": 5, "y": -4, "direction": "vertical" }
  ],
  "firstLetterCandidates": [
    { "x": 0, "y": -1, "direction": "vertical" }
  ]
}
```

### POST /api/expand

Расширяет кроссворд в указанной области (для авто-расширения при движении камеры).

**Body:**
```json
{
  "sessionId": "uuid из /api/generate",
  "bounds": { "x0": -50, "y0": -50, "x1": 50, "y1": 50 }
}
```

**Ответ:**
```json
{
  "newWords": [...],
  "totalWords": 42,
  "firstLetterCandidates": [...]
}
```

## Управление

- **Стрелки** — плавное перемещение камеры
- **Мышь (drag)** — перетаскивание

## Алгоритм генерации

1. Начинаем с seed-слова в позиции (0, 0)
2. Для каждой буквы генерируем позиции-кандидаты перпендикулярно
3. Для каждого кандидата перебираем слова из банка
4. Оцениваем размещение: базовый score = длина слова + бонус за пересечения
5. Выбираем слово с максимальным score
6. Блокируем соседние клетки (правила кроссворда)
7. Добавляем новые кандидаты и повторяем

## Тесты

Selenium тесты с headless Chrome и автоматическими скриншотами.

### Запуск тестов

```bash
cd tests
./run_tests.sh
```

Или вручную:

```bash
cd tests
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pytest test_crossword.py -v
```

**Важно:** Сервер должен быть запущен перед тестами.

### Что тестируется

- Загрузка страницы
- Рендеринг кроссворда
- Движение камеры (клавиатура и мышь)
- API генерации
- Связность слов

Скриншоты сохраняются в `tests/screenshots/`.

## Технологии

- **Frontend:** Paper.js (canvas рендеринг)
- **Backend:** Node.js, Express
- **Тесты:** Python, Selenium, pytest
- **Без внешних БД** — всё в памяти
